use crate::teletext::TeletextChar;
use core::fmt::Debug;

#[allow(dead_code)]
#[derive(Debug, Default, Copy, Clone)]
pub enum NationalOptionCharacterSubset {
    None, // Cannot be selected directly but can be used by enhancement packets

    #[default]
    English,
    German,
    Swedish,
    Finnish,
    Hungarian,
    Italian,
    French,
    Portuguese,
    Spanish,
    Czech,
    Slovak,
}

#[derive(Debug, Default, Copy, Clone)]
pub enum Diacritical {
    #[default]
    None,
    Grave,
    Acute,
    Circumflex,
    Tilde,
    Macron,
    Breve,
    Dot,
    Umlaut,
    DotBelow,
    Ring,
    Cedilla,
    #[allow(dead_code)]
    LowLine,
    DoubleAcute,
    Ogonek,
    Caron,
}

pub enum CharacterSet {
    G0,
    G0WithDiacritical(Diacritical),
    G2,
    G3,
}

impl NationalOptionCharacterSubset {
    fn has_char(&self, ch: char) -> Option<u8> {
        use NationalOptionCharacterSubset::*;

        macro_rules! subset_code {
            ($pattern:pat, $code:expr) => {
                match self {
                    $pattern => $code,
                    _ => return Option::None,
                }
            };
        }

        Some(match ch {
            '#' => match self {
                English | French | Italian => 0x5f,
                None | Czech | Slovak | German | Swedish | Finnish => 0x23,
                _ => return Option::None,
            },
            // English
            'Â£' => subset_code!(English | Italian, 0x23),
            '$' => subset_code!(English | German | Italian | Portuguese | Spanish, 0x24),
            '@' => subset_code!(English | None, 0x40),
            'â†' => subset_code!(English, 0x5b),
            'Â½' => subset_code!(English, 0x5c),
            'â†’' => subset_code!(English | Italian, 0x5d),
            'â†‘' => subset_code!(English | Italian, 0x5e),
            'â€”' => subset_code!(English, 0x60),
            'Â¼' => subset_code!(English, 0x7b),
            'â€–' => subset_code!(English, 0x7c),
            'Â¾' => subset_code!(English, 0x7d),
            'Ã·' => subset_code!(English, 0x7e),
            // German
            'Â§' => subset_code!(German, 0x40),
            'Ã„' => subset_code!(German | Swedish | Finnish, 0x5b),
            'Ã–' => subset_code!(German | Swedish | Finnish, 0x5c),
            'Ãœ' => subset_code!(German | Swedish | Finnish, 0x5d),
            '^' => subset_code!(German | None, 0x5e),
            '_' => subset_code!(German | None, 0x5f),
            'Â°' => subset_code!(German, 0x60),
            'Ã¤' => subset_code!(German | Swedish | Finnish, 0x7b),
            'Ã¶' => subset_code!(German | Swedish | Finnish, 0x7c),
            'Ã¼' => subset_code!(German, 0x7d),
            'ÃŸ' => subset_code!(German, 0x7e),

            // None
            'Â¤' => subset_code!(None, 0x24),
            '[' => subset_code!(None, 0x5B),
            '\\' => subset_code!(None, 0x5C),
            ']' => subset_code!(None, 0x5D),
            '`' => subset_code!(None, 0x60),
            '{' => subset_code!(None, 0x7B),
            '|' => subset_code!(None, 0x7C),
            '}' => subset_code!(None, 0x7D),
            '~' => subset_code!(None, 0x7E),

            _ => return Option::None,
        })
    }
}

impl Diacritical {
    pub fn code(&self) -> u8 {
        match self {
            Diacritical::None => 0x0,
            Diacritical::Grave => 0x1,
            Diacritical::Acute => 0x2,
            Diacritical::Circumflex => 0x3,
            Diacritical::Tilde => 0x4,
            Diacritical::Macron => 0x5,
            Diacritical::Breve => 0x6,
            Diacritical::Dot => 0x7,
            Diacritical::Umlaut => 0x8,
            Diacritical::DotBelow => 0x9,
            Diacritical::Ring => 0xA,
            Diacritical::Cedilla => 0xB,
            Diacritical::LowLine => 0xC,
            Diacritical::DoubleAcute => 0xD,
            Diacritical::Ogonek => 0xE,
            Diacritical::Caron => 0xF,
        }
    }
}

fn g0_set(ch: char, subset: NationalOptionCharacterSubset) -> Option<TeletextChar> {
    Some(TeletextChar(match ch {
        ' ' => 0x20,
        '!' => 0x21,
        '"' => 0x22,
        '%' => 0x25,
        '&' => 0x26,
        '\'' => 0x27,
        '(' => 0x28,
        ')' => 0x29,
        '*' if !matches!(subset, NationalOptionCharacterSubset::None) => 0x2a,
        '+' => 0x2b,
        ',' => 0x2c,
        '-' => 0x2d,
        '.' => 0x2e,
        '/' => 0x2f,

        '0'..='9' => (ch as u8) - b'0' + 0x30,
        ':' => 0x3a,
        ';' => 0x3b,
        '<' => 0x3c,
        '=' => 0x3d,
        '>' => 0x3e,
        '?' => 0x3f,

        'A'..='Z' => (ch as u8) - b'A' + 0x41,
        'a'..='z' => (ch as u8) - b'a' + 0x61,
        'â–ˆ' => 0x7f,

        // Used for spacing attributes and direct character access
        '\u{E000}'..='\u{E07F}' => (ch as u32 - 0xE000) as u8,

        _ => subset.has_char(ch)?,
    }))
}

fn g2_set(ch: char) -> Option<TeletextChar> {
    Some(TeletextChar(match ch {
        'Â¡' => 0x21,
        'Â¢' => 0x22,
        'Â£' => 0x23,
        '$' => 0x24,
        'Â¥' => 0x25,
        '#' => 0x26,
        'Â§' => 0x27,
        'Â¤' => 0x28,
        'â€˜' => 0x29,
        'â€œ' => 0x2A,
        'Â«' => 0x2B,
        'â†' => 0x2C,
        'â†‘' => 0x2D,
        'â†’' => 0x2E,
        'â†“' => 0x2F,

        'Â°' => 0x30,
        'Â±' => 0x31,
        'Â²' => 0x32,
        'Â³' => 0x33,
        'Ã—' => 0x34,
        'Âµ' => 0x35,
        'Â¶' => 0x36,
        'â‹…' => 0x37,
        'Ã·' => 0x38,
        'â€™' => 0x39,
        'â€' => 0x3A,
        'Â»' => 0x3B,
        'Â¼' => 0x3C,
        'Â½' => 0x3D,
        'Â¾' => 0x3E,
        'Â¿' => 0x3F,

        ' ' => 0x40,
        'Ì€' => 0x41,
        'Ì' => 0x42,
        'Ì‚' => 0x43,
        'Ìƒ' => 0x44,
        'Ì„' => 0x45,
        'Ì†' => 0x46,
        'Ì‡' => 0x47,
        'Ìˆ' => 0x48,
        'Ì£' => 0x49,
        'ÌŠ' => 0x4A,
        'Ì§' => 0x4B,
        'Ì²' => 0x4C,
        'Ì‹' => 0x4D,
        'Ì¨' => 0x4E,
        'ÌŒ' => 0x4F,

        'â€”' | 'â€•' => 0x50,
        'Â¹' => 0x51,
        'Â®' => 0x52,
        'Â©' => 0x53,
        'â„¢' => 0x54,
        'â™ª' | 'ðŸŽµ' => 0x55,
        'â‚ ' => 0x56,
        'â€°' => 0x57,
        'Î±' => 0x58,
        'â…›' => 0x5C,
        'â…œ' => 0x5D,
        'â…' => 0x5E,
        'â…ž' => 0x5F,

        'Î©' => 0x60,
        'Ã†' => 0x61,
        'Ä' => 0x62,
        'Âª' => 0x63,
        'Ä¦' => 0x64,
        'Ä²' => 0x66,
        'Ä¿' => 0x67,
        'Å' => 0x68,
        'Ã˜' => 0x69,
        'Å’' => 0x6A,
        'Âº' => 0x6B,
        'Ãž' => 0x6C,
        'Å¦' => 0x6D,
        'ÅŠ' => 0x6E,
        'Å‰' => 0x6F,

        'Ä¸' => 0x70,
        'Ã¦' => 0x71,
        'Ä‘' => 0x72,
        'Ã°' => 0x73,
        'Ä§' => 0x74,
        'Ä±' => 0x75,
        'Ä³' => 0x76,
        'Å€' => 0x77,
        'Å‚' => 0x78,
        'Ã¸' => 0x79,
        'Å“' => 0x7A,
        'ÃŸ' => 0x7B,
        'Ã¾' => 0x7C,
        'Å§' => 0x7D,
        'Å‹' => 0x7E,

        _ => return None,
    }))
}

fn g3_set(ch: char) -> Option<TeletextChar> {
    Some(TeletextChar(match ch {
        'ðŸ¬¼' => 0x20,
        'ðŸ¬½' => 0x21,
        'ðŸ¬¾' => 0x22,
        'ðŸ¬¿' => 0x23,
        'ðŸ­€' => 0x24,
        'â—£' => 0x25,
        'ðŸ­' => 0x26,
        'ðŸ­‚' => 0x27,
        'ðŸ­ƒ' => 0x28,
        'ðŸ­„' => 0x29,
        'ðŸ­…' => 0x2A,
        'ðŸ­†' => 0x2B,
        'ðŸ­¨' => 0x2C,
        'ðŸ­©' => 0x2D,
        'ðŸ­°' => 0x2E,
        'â–’' => 0x2F,

        'ðŸ­‡' => 0x30,
        'ðŸ­ˆ' => 0x31,
        'ðŸ­‰' => 0x32,
        'ðŸ­Š' => 0x33,
        'ðŸ­‹' => 0x34,
        'â—¢' => 0x35,
        'ðŸ­Œ' => 0x36,
        'ðŸ­' => 0x37,
        'ðŸ­Ž' => 0x38,
        'ðŸ­' => 0x39,
        'ðŸ­' => 0x3A,
        'ðŸ­‘' => 0x3B,
        'ðŸ­ª' => 0x3C,
        'ðŸ­«' => 0x3D,
        'ðŸ­µ' => 0x3E,
        'â–ˆ' => 0x3F,

        'â”·' => 0x40,
        'â”¯' => 0x41,
        'â”' => 0x42,
        'â”¥' => 0x43,
        'ðŸ®¤' => 0x44,
        'ðŸ®¥' => 0x45,
        'ðŸ®¦' => 0x46,
        'ðŸ®§' => 0x47,
        'ðŸ® ' => 0x48,
        'ðŸ®¡' => 0x49,
        'ðŸ®¢' => 0x4A,
        'ðŸ®£' => 0x4B,
        'â”¿' => 0x4C,
        'â€¢' => 0x4D,
        'â—' => 0x4E,
        'â—‹' => 0x4F,

        'â”‚' => 0x50,
        'â”€' => 0x51,
        'â”Œ' => 0x52,
        'â”' => 0x53,
        'â””' => 0x54,
        'â”˜' => 0x55,
        'â”œ' => 0x56,
        'â”¤' => 0x57,
        'â”¬' => 0x58,
        'â”´' => 0x59,
        'â”¼' => 0x5A,
        'â­¢' => 0x5B,
        'â­ ' => 0x5C,
        'â­¡' => 0x5D,
        'â­£' => 0x5E,

        'ðŸ­’' => 0x60,
        'ðŸ­“' => 0x61,
        'ðŸ­”' => 0x62,
        'ðŸ­•' => 0x63,
        'ðŸ­–' => 0x64,
        'â—¥' => 0x65,
        'ðŸ­—' => 0x66,
        'ðŸ­˜' => 0x67,
        'ðŸ­™' => 0x68,
        'ðŸ­š' => 0x69,
        'ðŸ­›' => 0x6A,
        'ðŸ­œ' => 0x6B,
        'ðŸ­¬' => 0x6C,
        'ðŸ­­' => 0x6D,

        'ðŸ­' => 0x70,
        'ðŸ­ž' => 0x71,
        'ðŸ­Ÿ' => 0x72,
        'ðŸ­ ' => 0x73,
        'ðŸ­¡' => 0x74,
        'â—¤' => 0x75,
        'ðŸ­¢' => 0x76,
        'ðŸ­£' => 0x77,
        'ðŸ­¤' => 0x78,
        'ðŸ­¥' => 0x79,
        'ðŸ­¦' => 0x7A,
        'ðŸ­§' => 0x7B,
        'ðŸ­®' => 0x7C,
        'ðŸ­¯' => 0x7D,
        _ => return None,
    }))
}

fn g0_set_with_diacriticals(ch: char) -> Option<(TeletextChar, Diacritical)> {
    let (base, diacritical) = match ch {
        'Ã€' => ('A', Diacritical::Grave),
        'Ã ' => ('a', Diacritical::Grave),
        'Ãˆ' => ('E', Diacritical::Grave),
        'Ã¨' => ('e', Diacritical::Grave),
        'ÃŒ' => ('I', Diacritical::Grave),
        'Ã¬' => ('i', Diacritical::Grave),
        'Ç¸' => ('N', Diacritical::Grave),
        'Ç¹' => ('n', Diacritical::Grave),
        'Ã’' => ('O', Diacritical::Grave),
        'Ã²' => ('o', Diacritical::Grave),
        'Ã™' => ('U', Diacritical::Grave),
        'Ã¹' => ('u', Diacritical::Grave),
        'áº€' => ('W', Diacritical::Grave),
        'áº' => ('w', Diacritical::Grave),
        'á»²' => ('Y', Diacritical::Grave),
        'á»³' => ('y', Diacritical::Grave),

        'Ã' => ('A', Diacritical::Acute),
        'Ã¡' => ('a', Diacritical::Acute),
        'Ä†' => ('C', Diacritical::Acute),
        'Ä‡' => ('c', Diacritical::Acute),
        'Ã‰' => ('E', Diacritical::Acute),
        'Ã©' => ('e', Diacritical::Acute),
        'Ç´' => ('G', Diacritical::Acute),
        'Çµ' => ('g', Diacritical::Acute),
        'Ã' => ('I', Diacritical::Acute),
        'Ã­' => ('i', Diacritical::Acute),
        'á¸°' => ('K', Diacritical::Acute),
        'á¸±' => ('k', Diacritical::Acute),
        'Ä¹' => ('L', Diacritical::Acute),
        'Äº' => ('l', Diacritical::Acute),
        'á¸¾' => ('M', Diacritical::Acute),
        'á¸¿' => ('m', Diacritical::Acute),
        'Åƒ' => ('N', Diacritical::Acute),
        'Å„' => ('n', Diacritical::Acute),
        'Ã“' => ('O', Diacritical::Acute),
        'Ã³' => ('o', Diacritical::Acute),
        'á¹”' => ('P', Diacritical::Acute),
        'á¹•' => ('p', Diacritical::Acute),
        'Å”' => ('R', Diacritical::Acute),
        'Å•' => ('r', Diacritical::Acute),
        'Åš' => ('S', Diacritical::Acute),
        'Å›' => ('s', Diacritical::Acute),
        'Ãš' => ('U', Diacritical::Acute),
        'Ãº' => ('u', Diacritical::Acute),
        'áº‚' => ('W', Diacritical::Acute),
        'áºƒ' => ('w', Diacritical::Acute),
        'Ã' => ('Y', Diacritical::Acute),
        'Ã½' => ('y', Diacritical::Acute),
        'Å¹' => ('Z', Diacritical::Acute),
        'Åº' => ('z', Diacritical::Acute),

        'Ã‚' => ('A', Diacritical::Circumflex),
        'Ã¢' => ('a', Diacritical::Circumflex),
        'Äˆ' => ('C', Diacritical::Circumflex),
        'Ä‰' => ('c', Diacritical::Circumflex),
        'ÃŠ' => ('E', Diacritical::Circumflex),
        'Ãª' => ('e', Diacritical::Circumflex),
        'Äœ' => ('G', Diacritical::Circumflex),
        'Ä' => ('g', Diacritical::Circumflex),
        'Ä¤' => ('H', Diacritical::Circumflex),
        'Ä¥' => ('h', Diacritical::Circumflex),
        'ÃŽ' => ('I', Diacritical::Circumflex),
        'Ã®' => ('i', Diacritical::Circumflex),
        'Ä´' => ('J', Diacritical::Circumflex),
        'Äµ' => ('j', Diacritical::Circumflex),
        'Ã”' => ('O', Diacritical::Circumflex),
        'Ã´' => ('o', Diacritical::Circumflex),
        'Åœ' => ('S', Diacritical::Circumflex),
        'Å' => ('s', Diacritical::Circumflex),
        'Ã›' => ('U', Diacritical::Circumflex),
        'Ã»' => ('u', Diacritical::Circumflex),
        'Å´' => ('W', Diacritical::Circumflex),
        'Åµ' => ('w', Diacritical::Circumflex),
        'Å¶' => ('Y', Diacritical::Circumflex),
        'Å·' => ('y', Diacritical::Circumflex),
        'áº' => ('Z', Diacritical::Circumflex),
        'áº‘' => ('z', Diacritical::Circumflex),

        'Ãƒ' => ('A', Diacritical::Tilde),
        'Ã£' => ('a', Diacritical::Tilde),
        'áº¼' => ('E', Diacritical::Tilde),
        'áº½' => ('e', Diacritical::Tilde),
        'Ä¨' => ('I', Diacritical::Tilde),
        'Ä©' => ('i', Diacritical::Tilde),
        'Ã‘' => ('N', Diacritical::Tilde),
        'Ã±' => ('n', Diacritical::Tilde),
        'Ã•' => ('O', Diacritical::Tilde),
        'Ãµ' => ('o', Diacritical::Tilde),
        'Å¨' => ('U', Diacritical::Tilde),
        'Å©' => ('u', Diacritical::Tilde),
        'á¹¼' => ('V', Diacritical::Tilde),
        'á¹½' => ('v', Diacritical::Tilde),
        'á»¸' => ('Y', Diacritical::Tilde),
        'á»¹' => ('y', Diacritical::Tilde),

        'Ä€' => ('A', Diacritical::Macron),
        'Ä' => ('a', Diacritical::Macron),
        'Ä’' => ('E', Diacritical::Macron),
        'Ä“' => ('e', Diacritical::Macron),
        'á¸ ' => ('G', Diacritical::Macron),
        'á¸¡' => ('g', Diacritical::Macron),
        'Äª' => ('I', Diacritical::Macron),
        'Ä«' => ('i', Diacritical::Macron),
        'ÅŒ' => ('O', Diacritical::Macron),
        'Å' => ('o', Diacritical::Macron),
        'Åª' => ('U', Diacritical::Macron),
        'Å«' => ('u', Diacritical::Macron),
        'È²' => ('Y', Diacritical::Macron),
        'È³' => ('y', Diacritical::Macron),

        'Ä‚' => ('A', Diacritical::Breve),
        'Äƒ' => ('a', Diacritical::Breve),
        'Ä”' => ('E', Diacritical::Breve),
        'Ä•' => ('e', Diacritical::Breve),
        'Äž' => ('G', Diacritical::Breve),
        'ÄŸ' => ('g', Diacritical::Breve),
        'Ä¬' => ('I', Diacritical::Breve),
        'Ä­' => ('i', Diacritical::Breve),
        'ÅŽ' => ('O', Diacritical::Breve),
        'Å' => ('o', Diacritical::Breve),
        'Å¬' => ('U', Diacritical::Breve),
        'Å­' => ('u', Diacritical::Breve),

        'È¦' => ('A', Diacritical::Dot),
        'È§' => ('a', Diacritical::Dot),
        'á¸‚' => ('B', Diacritical::Dot),
        'á¸ƒ' => ('b', Diacritical::Dot),
        'ÄŠ' => ('C', Diacritical::Dot),
        'Ä‹' => ('c', Diacritical::Dot),
        'á¸Š' => ('D', Diacritical::Dot),
        'á¸‹' => ('d', Diacritical::Dot),
        'Ä–' => ('E', Diacritical::Dot),
        'Ä—' => ('e', Diacritical::Dot),
        'á¸ž' => ('F', Diacritical::Dot),
        'á¸Ÿ' => ('f', Diacritical::Dot),
        'Ä ' => ('G', Diacritical::Dot),
        'Ä¡' => ('g', Diacritical::Dot),
        'á¸¢' => ('H', Diacritical::Dot),
        'á¸£' => ('h', Diacritical::Dot),
        'Ä°' => ('I', Diacritical::Dot),
        'á¹€' => ('M', Diacritical::Dot),
        'á¹' => ('m', Diacritical::Dot),
        'á¹„' => ('N', Diacritical::Dot),
        'á¹…' => ('n', Diacritical::Dot),
        'È®' => ('O', Diacritical::Dot),
        'È¯' => ('o', Diacritical::Dot),
        'á¹–' => ('P', Diacritical::Dot),
        'á¹—' => ('p', Diacritical::Dot),
        'á¹˜' => ('R', Diacritical::Dot),
        'á¹™' => ('r', Diacritical::Dot),
        'á¹ ' => ('S', Diacritical::Dot),
        'á¹¡' => ('s', Diacritical::Dot),
        'á¹ª' => ('T', Diacritical::Dot),
        'á¹«' => ('t', Diacritical::Dot),
        'áº†' => ('W', Diacritical::Dot),
        'áº‡' => ('w', Diacritical::Dot),
        'áºŠ' => ('X', Diacritical::Dot),
        'áº‹' => ('x', Diacritical::Dot),
        'áºŽ' => ('Y', Diacritical::Dot),
        'áº' => ('y', Diacritical::Dot),
        'Å»' => ('Z', Diacritical::Dot),
        'Å¼' => ('z', Diacritical::Dot),

        'Ã„' => ('A', Diacritical::Umlaut),
        'Ã¤' => ('a', Diacritical::Umlaut),
        'Ã‹' => ('E', Diacritical::Umlaut),
        'Ã«' => ('e', Diacritical::Umlaut),
        'á¸¦' => ('H', Diacritical::Umlaut),
        'á¸§' => ('h', Diacritical::Umlaut),
        'Ã' => ('I', Diacritical::Umlaut),
        'Ã¯' => ('i', Diacritical::Umlaut),
        'Ã–' => ('O', Diacritical::Umlaut),
        'Ã¶' => ('o', Diacritical::Umlaut),
        'áº—' => ('t', Diacritical::Umlaut),
        'Ãœ' => ('U', Diacritical::Umlaut),
        'Ã¼' => ('u', Diacritical::Umlaut),
        'áº„' => ('W', Diacritical::Umlaut),
        'áº…' => ('w', Diacritical::Umlaut),
        'áºŒ' => ('X', Diacritical::Umlaut),
        'áº' => ('x', Diacritical::Umlaut),
        'Å¸' => ('Y', Diacritical::Umlaut),
        'Ã¿' => ('y', Diacritical::Umlaut),

        'áº ' => ('A', Diacritical::DotBelow),
        'áº¡' => ('a', Diacritical::DotBelow),
        'á¸„' => ('B', Diacritical::DotBelow),
        'á¸…' => ('b', Diacritical::DotBelow),
        'á¸Œ' => ('D', Diacritical::DotBelow),
        'á¸' => ('d', Diacritical::DotBelow),
        'áº¸' => ('E', Diacritical::DotBelow),
        'áº¹' => ('e', Diacritical::DotBelow),
        'á¸¤' => ('H', Diacritical::DotBelow),
        'á¸¥' => ('h', Diacritical::DotBelow),
        'á»Š' => ('I', Diacritical::DotBelow),
        'á»‹' => ('i', Diacritical::DotBelow),
        'á¸²' => ('K', Diacritical::DotBelow),
        'á¸³' => ('k', Diacritical::DotBelow),
        'á¸¶' => ('L', Diacritical::DotBelow),
        'á¸·' => ('l', Diacritical::DotBelow),
        'á¹‚' => ('M', Diacritical::DotBelow),
        'á¹ƒ' => ('m', Diacritical::DotBelow),
        'á¹†' => ('N', Diacritical::DotBelow),
        'á¹‡' => ('n', Diacritical::DotBelow),
        'á»Œ' => ('O', Diacritical::DotBelow),
        'á»' => ('o', Diacritical::DotBelow),
        'á¹š' => ('R', Diacritical::DotBelow),
        'á¹›' => ('r', Diacritical::DotBelow),
        'á¹¢' => ('S', Diacritical::DotBelow),
        'á¹£' => ('s', Diacritical::DotBelow),
        'á¹¬' => ('T', Diacritical::DotBelow),
        'á¹­' => ('t', Diacritical::DotBelow),
        'á»¤' => ('U', Diacritical::DotBelow),
        'á»¥' => ('u', Diacritical::DotBelow),
        'á¹¾' => ('V', Diacritical::DotBelow),
        'á¹¿' => ('v', Diacritical::DotBelow),
        'áºˆ' => ('W', Diacritical::DotBelow),
        'áº‰' => ('w', Diacritical::DotBelow),
        'á»´' => ('Y', Diacritical::DotBelow),
        'á»µ' => ('y', Diacritical::DotBelow),
        'áº’' => ('Z', Diacritical::DotBelow),
        'áº“' => ('z', Diacritical::DotBelow),

        'Ã…' => ('A', Diacritical::Ring),
        'Ã¥' => ('a', Diacritical::Ring),
        'Å®' => ('U', Diacritical::Ring),
        'Å¯' => ('u', Diacritical::Ring),
        'áº˜' => ('w', Diacritical::Ring),
        'áº™' => ('y', Diacritical::Ring),

        'Ã‡' => ('C', Diacritical::Cedilla),
        'Ã§' => ('c', Diacritical::Cedilla),
        'á¸' => ('D', Diacritical::Cedilla),
        'á¸‘' => ('d', Diacritical::Cedilla),
        'È¨' => ('E', Diacritical::Cedilla),
        'È©' => ('e', Diacritical::Cedilla),
        'Ä¢' => ('G', Diacritical::Cedilla),
        'Ä£' => ('g', Diacritical::Cedilla),
        'á¸¨' => ('H', Diacritical::Cedilla),
        'á¸©' => ('h', Diacritical::Cedilla),
        'Ä¶' => ('K', Diacritical::Cedilla),
        'Ä·' => ('k', Diacritical::Cedilla),
        'Ä»' => ('L', Diacritical::Cedilla),
        'Ä¼' => ('l', Diacritical::Cedilla),
        'Å…' => ('N', Diacritical::Cedilla),
        'Å†' => ('n', Diacritical::Cedilla),
        'Å–' => ('R', Diacritical::Cedilla),
        'Å—' => ('r', Diacritical::Cedilla),
        'Åž' => ('S', Diacritical::Cedilla),
        'ÅŸ' => ('s', Diacritical::Cedilla),
        'Å¢' => ('T', Diacritical::Cedilla),
        'Å£' => ('t', Diacritical::Cedilla),

        'Å' => ('O', Diacritical::DoubleAcute),
        'Å‘' => ('o', Diacritical::DoubleAcute),
        'Å°' => ('U', Diacritical::DoubleAcute),
        'Å±' => ('u', Diacritical::DoubleAcute),

        'Ä„' => ('A', Diacritical::Ogonek),
        'Ä…' => ('a', Diacritical::Ogonek),
        'Ä˜' => ('E', Diacritical::Ogonek),
        'Ä™' => ('e', Diacritical::Ogonek),
        'Ä®' => ('I', Diacritical::Ogonek),
        'Ä¯' => ('i', Diacritical::Ogonek),
        'Çª' => ('O', Diacritical::Ogonek),
        'Ç«' => ('o', Diacritical::Ogonek),
        'Å²' => ('U', Diacritical::Ogonek),
        'Å³' => ('u', Diacritical::Ogonek),

        'Ç' => ('A', Diacritical::Caron),
        'ÇŽ' => ('a', Diacritical::Caron),
        'ÄŒ' => ('C', Diacritical::Caron),
        'Ä' => ('c', Diacritical::Caron),
        'ÄŽ' => ('D', Diacritical::Caron),
        'Ä' => ('d', Diacritical::Caron),
        'Äš' => ('E', Diacritical::Caron),
        'Ä›' => ('e', Diacritical::Caron),
        'Ç¦' => ('G', Diacritical::Caron),
        'Ç§' => ('g', Diacritical::Caron),
        'Èž' => ('H', Diacritical::Caron),
        'ÈŸ' => ('h', Diacritical::Caron),
        'Ç' => ('I', Diacritical::Caron),
        'Ç' => ('i', Diacritical::Caron),
        'Ç°' => ('j', Diacritical::Caron),
        'Ç¨' => ('K', Diacritical::Caron),
        'Ç©' => ('k', Diacritical::Caron),
        'Ä½' => ('L', Diacritical::Caron),
        'Ä¾' => ('l', Diacritical::Caron),
        'Å‡' => ('N', Diacritical::Caron),
        'Åˆ' => ('n', Diacritical::Caron),
        'Ç‘' => ('O', Diacritical::Caron),
        'Ç’' => ('o', Diacritical::Caron),
        'Å˜' => ('R', Diacritical::Caron),
        'Å™' => ('r', Diacritical::Caron),
        'Å ' => ('S', Diacritical::Caron),
        'Å¡' => ('s', Diacritical::Caron),
        'Å¤' => ('T', Diacritical::Caron),
        'Å¥' => ('t', Diacritical::Caron),
        'Ç“' => ('U', Diacritical::Caron),
        'Ç”' => ('u', Diacritical::Caron),
        'Å½' => ('Z', Diacritical::Caron),
        'Å¾' => ('z', Diacritical::Caron),

        a => (a, Diacritical::None)
    };

    let base_g0 = g0_set(base, NationalOptionCharacterSubset::None)?;

    Some((
        base_g0,
        diacritical
    ))
}

pub fn char_to_teletext(
    ch: char,
    subset: NationalOptionCharacterSubset,
    force_diacritical: Option<Diacritical>
) -> Option<(TeletextChar, CharacterSet)> {
    let tpl = g0_set(ch, subset)
        .map(|ch| (ch, CharacterSet::G0))
        .or_else(|| g2_set(ch).map(|ch| (ch, CharacterSet::G2)))
        .or_else(|| g3_set(ch).map(|ch| (ch, CharacterSet::G3)))
        .or_else(|| {
            g0_set_with_diacriticals(ch).map(|(ch, dia)| (ch, CharacterSet::G0WithDiacritical(dia)))
        });


    if let Some(diacritical) = force_diacritical {
        match tpl {
            Some((ch, CharacterSet::G0 | CharacterSet::G0WithDiacritical(_))) => Some((ch, CharacterSet::G0WithDiacritical(diacritical))),
            a => a
        }
    } else {
        tpl
    }
}
